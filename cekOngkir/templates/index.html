{% extends 'base.html' %} {% load static %} {% block app_css %}
<link rel="stylesheet" href="{% static 'cekOngkir/css/styles.css' %}" />
{% endblock %} {% block content %}
<div class="form-ongkir">
  <h3>üîç Data Pengiriman</h3>
  <form method="get">
    <div class="ongkir">
      <div class="asal-pengiriman">
        <!-- Asal Pengiriman -->
        <h5>Asal Pengiriman</h5>
        <div class="form-prov asal-prov">
          <label for="tujuan-prov">Provinsi: </label>
          <select id="asal-prov" name="asal-prov">
            <option value="">-- Pilih Provinsi --</option>
            {% for prov in provinces %}
            <option value="{{ prov.id }}">{{ prov.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-city asal-city">
          <label for="asal-city">Kota/Kabupaten: </label>
          <select id="asal-city" name="asal-city">
            <option value="">-- Pilih Kota --</option>
          </select>
        </div>
      </div>
      <!-- Tujuan Pengiriman -->
      <div class="tujuan-pengiriman">
        <h5>Tujuan Pengiriman</h5>
        <div class="form-prov tujuan-prov">
          <label for="tujuan-prov">Provinsi: </label>
          <select id="tujuan-prov" name="tujuan-prov">
            <option value="">-- Pilih Provinsi --</option>
          </select>
        </div>
        <div class="form-city tujuan-city">
          <label for="tujuan-city">Kota/Kabupaten: </label>
          <select id="tujuan-city" name="tujuan-city">
            <option value="">-- Pilih Kota --</option>
          </select>
        </div>
      </div>
      <div class="form-weight weight">
        <label for="weight">Berat: </label>
        <input id="weight" type="text" name="weight" placeholder="-- Masukan Berat (kg) --" />
      </div>
      <input id="submit" type="submit" value="Cek Ongkir" />
    </div>
  </form>
</div>
<div class="data-ongkir">
  <h3>üí∞ Tarif Ongkir</h3>
</div>
<script>
  function loadCities(provinceSelectId, citySelectId) {
    const provinceSelect = document.getElementById(provinceSelectId);
    const citySelect = document.getElementById(citySelectId);

    if (!provinceSelect || !citySelect) {
      console.warn(`Element tidak ditemukan: ${provinceSelectId} / ${citySelectId}`);
      return;
    }

    provinceSelect.addEventListener("change", function () {
      const provinceId = this.value;
      citySelect.innerHTML = "<option>Loading...</option>";

      if (!provinceId) {
        citySelect.innerHTML = '<option value="">Pilih Kota</option>';
        return;
      }

      fetch(`/ajax/cities/?province_id=${provinceId}`)
        .then((res) => res.json())
        .then((data) => {
          citySelect.innerHTML = '<option value="">Pilih Kota</option>';
          data.cities.forEach((city) => {
            const opt = document.createElement("option");
            opt.value = city.id;
            opt.textContent = `${city.type} ${city.name}`;
            citySelect.appendChild(opt);
          });
        })
        .catch((err) => {
          console.error(err);
          citySelect.innerHTML = '<option value="">Gagal memuat kota</option>';
        });
    });
  }

  loadCities("asal-prov", "asal-city");
  loadCities("tujuan-prov", "tujuan-city");
</script>
{% endblock %}
